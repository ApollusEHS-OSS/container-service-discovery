= Service Discovery in Container Orchestration Frameworks on AWS

This repo has a simple example that shows service discovery for different container orchestration frameworks.

The sample application uses three services:

image::images/services.png[]

. `webapp`: Web application queries `greeter` and `name` service to generate a greeting for a person.
. `greeter`: A service returns a greeting based upon `greet` name/value keypair in the URL.
. `name`: A service that returns person's name based upon `id` name/value keypair in the URL.

All services are built as Node.js application. `webapp` service need to be configured using four parameters:

. `GREETER_SERVICE_HOST`
. `GREETER_SERCICE_PORT`
. `GREETER_SERCICE_PATH`
. `NAME_SERVICE_HOST`
. `NAME_SERVICE_PORT`
. `NAME_SERVICE_PATH`

== Build services

Build the Docker images for different services:

```
docker-compose build
```

== Run services

=== Using Docker

The four parameter values are defined in `docker-compose.yml`.

Start the services:

```
docker swarm init
docker stack up --compose-file=docker-compose.yml webapp
```

=== Using ECS

Setup cluster and configure services as explained in link:ecs.adoc[Service Discovery for Microservices with Amazon ECS].

image::images/ecs-services.png[]

== Access service using web application

Access the following URLs using curl or in browser:

```
http://<host>:<port>
http://<host>:<port>0?greet=ho
http://<host>:<port>?id=1
http://<host>:<port>?greet=ho&id=1
```

[options="header"]
|=======
|Framework |<host> |<port>
| <host> | `localhost` | `8080`
| <port> | External ALB Address | `80`
|=======

== Delete services

=== Using Docker

```
docker stack rm webapp
docker swarm leave -f
```

=== Using ECS

. Delete ALB
. Delete Target Groups
. Scale down all services
. Deregister tasks
. Delete services
. Delete cluster

